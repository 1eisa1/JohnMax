<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Simple Login Demo</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f4f4f4; margin:0; }
    .container { max-width: 420px; margin: 40px auto; background:#fff; padding: 20px; border-radius: 10px; }
    h1 { margin-top: 0; }
    label { display:block; margin-top: 12px; }
    input { width:100%; padding:10px; margin-top:6px; box-sizing:border-box; }
    button { width:100%; padding:10px; margin-top:14px; cursor:pointer; }
    .row { display:flex; gap:10px; margin-top: 12px; }
    .row button { width: 50%; }
    .msg { margin-top: 12px; padding: 10px; border-radius: 8px; display:none; }
    .msg.ok { background:#e7f7ea; border:1px solid #b7e4c7; color:#1b5e20; }
    .msg.err { background:#fdecea; border:1px solid #f5c6cb; color:#7f1d1d; }
    .small { color:#555; font-size: 0.9rem; margin-top: 8px; }
    .link { background:none; border:none; color:#2563eb; text-decoration:underline; padding:0; margin-top:10px; cursor:pointer; }
    .hidden { display:none; }
    .topbar { display:flex; justify-content:space-between; align-items:center; margin-bottom: 10px; }
    .pill { background:#111827; color:#fff; padding:6px 10px; border-radius: 999px; font-size: 0.85rem; }
  </style>
</head>
<body>
  <div class="container">
    <div class="topbar">
      <h1 id="pageTitle">Welcome</h1>
      <span class="pill" id="statusPill">Guest</span>
    </div>

    <div id="message" class="msg"></div>

    <!-- SIGN IN VIEW -->
    <div id="signInView">
      <h2>Sign In</h2>
      <label>Email</label>
      <input id="inEmail" type="email" placeholder="you@example.com" autocomplete="username"/>

      <label>Password</label>
      <input id="inPass" type="password" placeholder="Password" autocomplete="current-password"/>

      <button id="signInBtn">Sign In</button>

      <p class="small">Donâ€™t have an account?</p>
      <button class="link" id="goToSignUp">Create one (Sign Up)</button>
    </div>

    <!-- SIGN UP VIEW -->
    <div id="signUpView" class="hidden">
      <h2>Sign Up</h2>
      <label>Name</label>
      <input id="upName" type="text" placeholder="Your name" autocomplete="name"/>

      <label>Email</label>
      <input id="upEmail" type="email" placeholder="you@example.com" autocomplete="username"/>

      <label>Password</label>
      <input id="upPass" type="password" placeholder="Create a password" autocomplete="new-password"/>

      <label>Confirm Password</label>
      <input id="upPass2" type="password" placeholder="Confirm password" autocomplete="new-password"/>

      <button id="signUpBtn">Create Account</button>

      <p class="small">Already have an account?</p>
      <button class="link" id="goToSignIn">Go back to Sign In</button>
    </div>

    <!-- DASHBOARD VIEW (LOGGED IN) -->
    <div id="dashboardView" class="hidden">
      <h2>Dashboard</h2>
      <p id="welcomeText">You are logged in.</p>

      <div class="row">
        <button id="logoutBtn">Logout</button>
        <button id="deleteBtn" title="Deletes the account from this browser">Delete Account</button>
      </div>

      <p class="small">
        This demo saves accounts in <b>localStorage</b> (only this browser/device).
      </p>
    </div>
  </div>

  <script>
    // -----------------------------
    // Helpers
    // -----------------------------
    function showMsg(text, type) {
      const box = document.getElementById("message");
      box.textContent = text;
      box.className = "msg " + (type === "ok" ? "ok" : "err");
      box.style.display = "block";
    }

    function clearMsg() {
      const box = document.getElementById("message");
      box.style.display = "none";
      box.textContent = "";
    }

    function showView(viewId) {
      clearMsg();
      document.getElementById("signInView").classList.add("hidden");
      document.getElementById("signUpView").classList.add("hidden");
      document.getElementById("dashboardView").classList.add("hidden");
      document.getElementById(viewId).classList.remove("hidden");
    }

    function setStatus(text) {
      document.getElementById("statusPill").textContent = text;
    }

    // -----------------------------
    // "Database" using localStorage
    // -----------------------------
    // Store users under key: "users"
    // Format: { "email@example.com": { name: "Name", password: "pass" } }
    function getUsers() {
      const raw = localStorage.getItem("users");
      return raw ? JSON.parse(raw) : {};
    }

    function setUsers(usersObj) {
      localStorage.setItem("users", JSON.stringify(usersObj));
    }

    // Logged-in session key: "currentUser"
    function getCurrentUserEmail() {
      return localStorage.getItem("currentUser"); // email string or null
    }

    function setCurrentUserEmail(email) {
      localStorage.setItem("currentUser", email);
    }

    function clearCurrentUser() {
      localStorage.removeItem("currentUser");
    }

    // -----------------------------
    // Auth logic
    // -----------------------------
    function signUp(name, email, pass, pass2) {
      // SEQUENCE: validate -> save -> message
      if (!name || !email || !pass || !pass2) {
        showMsg("Please fill in all fields.", "err");
        return;
      }

      // SELECTION: check password match
      if (pass !== pass2) {
        showMsg("Passwords do not match.", "err");
        return;
      }

      const users = getUsers();

      // SELECTION: prevent duplicate email
      if (users[email]) {
        showMsg("That email is already registered. Try signing in.", "err");
        return;
      }

      // Save user (demo only; real apps NEVER store plain passwords)
      users[email] = { name: name, password: pass };
      setUsers(users);

      showMsg("Account created! Now sign in.", "ok");
      showView("signInView");

      // Clear signup inputs
      document.getElementById("upName").value = "";
      document.getElementById("upEmail").value = "";
      document.getElementById("upPass").value = "";
      document.getElementById("upPass2").value = "";
    }

    function signIn(email, pass) {
      if (!email || !pass) {
        showMsg("Enter your email and password.", "err");
        return;
      }

      const users = getUsers();
      const user = users[email];

      // SELECTION: user exists + password matches
      if (!user) {
        showMsg("No account found with that email. Please sign up.", "err");
        return;
      }
      if (user.password !== pass) {
        showMsg("Incorrect password.", "err");
        return;
      }

      // Set "session"
      setCurrentUserEmail(email);
      showDashboard();
    }

    function showDashboard() {
      const email = getCurrentUserEmail();
      const users = getUsers();

      // SELECTION: if session missing, go to sign in
      if (!email || !users[email]) {
        clearCurrentUser();
        setStatus("Guest");
        document.getElementById("pageTitle").textContent = "Welcome";
        showView("signInView");
        return;
      }

      const name = users[email].name;

      setStatus("Logged In");
      document.getElementById("pageTitle").textContent = "Home";
      document.getElementById("welcomeText").textContent =
        "Welcome, " + name + "! You are signed in as " + email + ".";

      showView("dashboardView");
    }

    function logout() {
      clearCurrentUser();
      setStatus("Guest");
      document.getElementById("pageTitle").textContent = "Welcome";
      showView("signInView");
      showMsg("You have been logged out.", "ok");
    }

    function deleteAccount() {
      const email = getCurrentUserEmail();
      const users = getUsers();

      if (!email || !users[email]) {
        showMsg("No account to delete.", "err");
        return;
      }

      // Remove user + logout
      delete users[email];
      setUsers(users);
      clearCurrentUser();

      setStatus("Guest");
      document.getElementById("pageTitle").textContent = "Welcome";
      showView("signInView");
      showMsg("Account deleted from this browser.", "ok");
    }

    // -----------------------------
    // Button Events
    // -----------------------------
    document.getElementById("goToSignUp").addEventListener("click", () => {
      document.getElementById("pageTitle").textContent = "Create Account";
      showView("signUpView");
    });

    document.getElementById("goToSignIn").addEventListener("click", () => {
      document.getElementById("pageTitle").textContent = "Welcome";
      showView("signInView");
    });

    document.getElementById("signUpBtn").addEventListener("click", () => {
      const name = document.getElementById("upName").value.trim();
      const email = document.getElementById("upEmail").value.trim().toLowerCase();
      const pass = document.getElementById("upPass").value;
      const pass2 = document.getElementById("upPass2").value;
      signUp(name, email, pass, pass2);
    });

    document.getElementById("signInBtn").addEventListener("click", () => {
      const email = document.getElementById("inEmail").value.trim().toLowerCase();
      const pass = document.getElementById("inPass").value;
      signIn(email, pass);
    });

    document.getElementById("logoutBtn").addEventListener("click", logout);
    document.getElementById("deleteBtn").addEventListener("click", deleteAccount);

    // Allow Enter key to submit on sign in
    document.getElementById("inPass").addEventListener("keydown", (e) => {
      if (e.key === "Enter") document.getElementById("signInBtn").click();
    });

    // On page load: if already logged in, show dashboard
    showDashboard();
  </script>
</body>
</html>
